---
alwaysApply: true
---

# R√®gles de d√©veloppement - Approche p√©dagogique

## Philosophie g√©n√©rale

**Approche p√©dagogique prioritaire** : Tu ne codes pas √† ma place, tu m'apprends √† le faire et tu me guides pas √† pas au d√©tail pr√®s. Tu v√©rifies mon code et le corriges avec moi. Tu modifies seulement si je te le dis explicitement.

**üî¥ R√àGLE PRIMORDIALE - √âcriture du Code** : **√âviter d'√™tre trop verbeux dans le code**
- ‚úÖ **Code concis et clair** : Privil√©gier la concision sans sacrifier la lisibilit√©
- ‚úÖ **Commentaires essentiels uniquement** : Commenter seulement ce qui n'est pas √©vident
- ‚úÖ **Noms explicites** : Utiliser des noms de variables/fonctions clairs plut√¥t que des commentaires
- ‚ùå **√âviter** : Commentaires redondants, code verbeux, explications √©videntes
- **Impact** : Le code verbeux affecte n√©gativement le "vibe coding" et la productivit√©

## R√®gles par contexte de d√©veloppement

### Backend / API / Services

- **Mode p√©dagogique** : Tu ne codes pas, tu m'apprends
- **Processus** :
  1. Tu me donnes le code √† √©crire avec des explications d√©taill√©es
  2. Tu m'expliques ce qu'on fait et pourquoi
  3. Je code les fichiers moi-m√™me
  4. Tu v√©rifies mon code une fois termin√©
  5. On corrige ensemble jusqu'√† r√©ussir

### üóÑÔ∏è Configuration Base de Donn√©es - R√àGLE CRITIQUE

**R√àGLE FONDAMENTALE** : **La base de donn√©es Reboul Store est TOUJOURS sur le VPS**, que ce soit en d√©veloppement local ou en production.

#### Principe unique

- ‚úÖ **D√©veloppement local** : Connexion au VPS via tunnel SSH (`host.docker.internal:5433`)
- ‚úÖ **Production** : Connexion directe au VPS
- ‚ùå **JAMAIS** de base de donn√©es locale Docker pour Reboul Store
- ‚ùå **JAMAIS** utiliser `DB_HOST=postgres` ou `DB_HOST=localhost` pour Reboul Store

#### Configuration d√©veloppement local

**Fichier `.env` √† la racine** (charg√© automatiquement par docker-compose) :
```bash
# Configuration pour connexion √† la base de donn√©es VPS via tunnel SSH
DB_HOST=host.docker.internal
DB_PORT=5433
DB_USERNAME=reboulstore
DB_PASSWORD=reboulstore_password
DB_DATABASE=reboulstore_db
```

**Tunnel SSH requis** :
- Le tunnel SSH expose PostgreSQL du VPS sur `localhost:5433` de la machine locale
- Commande tunnel : `ssh -L 5433:localhost:5432 -i ~/.ssh/id_ed25519 deploy@152.228.218.35 -N`
- Le container Docker utilise `host.docker.internal:5433` pour acc√©der au tunnel

#### Configuration production

**Fichier `.env.production`** :
- Contient les credentials de connexion directe au VPS
- Utilis√© par les containers Docker en production
- **NE JAMAIS modifier** ce fichier sans autorisation explicite

#### Scripts et outils

**Tous les scripts** (seed, migrations, etc.) :
- ‚úÖ Utilisent **UNIQUEMENT** les variables d'environnement charg√©es
- ‚úÖ Se connectent **TOUJOURS** au VPS (via tunnel en dev, direct en prod)
- ‚úÖ **JAMAIS** de d√©tection automatique localhost/Docker
- ‚úÖ **JAMAIS** de connexion √† `postgres:5432` (container local)

**Exemple seed script** :
```typescript
// ‚úÖ CORRECT : Utilise les variables d'environnement (VPS)
const dbHost = process.env.DB_HOST; // host.docker.internal (dev) ou VPS (prod)
const dbPort = process.env.DB_PORT; // 5433 (dev) ou 5432 (prod)

// ‚ùå INCORRECT : D√©tection automatique ou valeurs par d√©faut locales
// const dbHost = process.env.DB_HOST || 'postgres'; // ‚ùå
// const dbHost = isDocker ? 'postgres' : 'localhost'; // ‚ùå
```

#### R√®gles d'application

‚úÖ **√Ä FAIRE** :
- Toujours utiliser les variables d'environnement pour la connexion DB
- V√©rifier que le tunnel SSH est actif en d√©veloppement local
- Utiliser `host.docker.internal:5433` en d√©veloppement (via tunnel)
- Utiliser les credentials VPS en production
- Documenter toute modification de configuration DB

‚ùå **√Ä √âVITER** :
- Utiliser une base de donn√©es locale Docker pour Reboul Store
- Hardcoder `DB_HOST=postgres` ou `DB_HOST=localhost`
- D√©tecter automatiquement l'environnement pour choisir la DB
- Cr√©er une base de donn√©es locale pour le d√©veloppement
- Modifier `.env.production` sans autorisation

#### CLI DB Reboul (`./rcli db ...`) ‚Äì Voir et √©diter les articles rapidement

**R√àGLE ‚Äì Priorit√© CLI pour les op√©rations base de donn√©es** : Pour toute op√©ration sur la base Reboul (consultation, √©dition stocks, produits, commandes, export), **utiliser en priorit√© le CLI** (`./rcli db ...`). L‚ÄôIA a acc√®s complet √† cet outil ; cela permet de g√©rer les stocks et les donn√©es ensemble (utilisateur + LLM) de fa√ßon coh√©rente et tra√ßable.

- ‚úÖ **Reference Finder** : `./rcli db ref <REF>` ‚Äî hub par r√©f√©rence : affiche produit + variants + toutes les commandes d‚Äô√©dition pr√™tes √† copier-coller (set-name, set-price, set-all-stock, variant-set-stock, variant-delete, etc.). Id√©al pour **v√©rifier une feuille de stock** : prendre chaque ref de la feuille et lancer `./rcli db ref <REF>` pour contr√¥ler que la ref est bonne en base.
- ‚úÖ **Lecture** : `product-find`, `product-list` (par marque/collection), `variant-list`, `check-sequences`, `order-list`, `order-detail`, `cart-list` ‚Äî 100 % read-only.
- ‚úÖ **√âdition** : stock (variant / tous), couleur (variant / tous), taille, `variant-add`, `variant-delete`, `product-set-price`, `product-set-active`, nom/r√©f/cat√©gorie/marque/collection ‚Äî **backup auto** avant modification (sauf `--no-backup`) et **confirmation** (`--yes` ou prompt).
- ‚úÖ **Export** : `export-csv --brand "X"` [--collection Y] [-o file.csv].
- ‚úÖ R√©f√©rence : `docs/context/DB_CLI_USAGE.md` | Commande Cursor : `/db-cli-workflow`.
- ‚ùå Base **toujours sur VPS** ; ne jamais utiliser une DB locale Docker pour Reboul.

#### V√©rification

**Pour v√©rifier la connexion** :
```bash
# V√©rifier les variables d'environnement du container
docker exec reboulstore-backend printenv | grep DB_

# Devrait afficher (en dev local) :
# DB_HOST=host.docker.internal
# DB_PORT=5433
# DB_USERNAME=reboulstore
# DB_DATABASE=reboulstore_db
```

**Si le tunnel SSH n'est pas actif en dev** :
- La connexion √©chouera avec `ECONNREFUSED`
- Activer le tunnel SSH avant de d√©marrer les containers
- V√©rifier que le tunnel est bien sur le port 5433

### Frontend / Interface utilisateur

#### üé¨ Workflow Animations AnimeJS

**Biblioth√®que principale** : **AnimeJS**

##### Philosophie des animations

- **R√©utilisabilit√©** : Chaque animation doit √™tre dans un fichier d√©di√© et r√©utilisable
- **Coh√©rence** : Utiliser les constantes d√©finies dans `animations/utils/constants.ts`
- **Performance** : AnimeJS garantit 60fps, utiliser `AnimationProvider` pour le nettoyage
- **Documentation** : Chaque animation doit √™tre document√©e avec JSDoc

##### Structure

`frontend/src/animations/` : `index.ts`, `presets/` (r√©utilisables), `components/[ComponentName]/`, `utils/constants.ts` + `animejs-helpers.ts`.

##### R√©f√©rence

- **Workflow, exemples, processus** : `docs/animations/ANIMATIONS_GUIDE.md` (cr√©ation, utilisation avec `useAnimation()`, nettoyage).
- **AnimeJS** : https://animejs.com/

##### Bonnes pratiques

- ‚úÖ Toujours cr√©er des animations r√©utilisables dans `presets/`
- ‚úÖ Utiliser `useAnimation()` hook (via `AnimationProvider`) pour le nettoyage
- ‚úÖ Respecter les constantes d√©finies (`ANIMATION_DURATIONS`, `ANIMATION_EASES`)
- ‚úÖ Utiliser `toMilliseconds()` et `convertEasing()` pour la compatibilit√©
- ‚úÖ Documenter avec JSDoc
- ‚úÖ Respecter `prefers-reduced-motion` pour l'accessibilit√© (via `useAnimation()`)
- ‚ùå Ne pas dupliquer le code d'animation dans plusieurs composants
- ‚ùå Ne pas oublier de nettoyer les animations au d√©montage

#### üé® Workflow Figma ‚Üí Frontend (PRIORITAIRE)

**Philosophie** : Design d'abord dans Figma, puis impl√©mentation propre en code

##### Quand utiliser Figma ?

**TOUJOURS** avant de cr√©er une nouvelle page ou composant UI complexe :
- ‚úÖ Pages compl√®tes (Login, Register, Profile, Checkout, Admin, etc.)
- ‚úÖ Composants UI complexes (formulaires, cartes, modales, etc.)
- ‚úÖ Nouveaux layouts ou sections
- ‚úÖ Modifications importantes de design

**Pas n√©cessaire** pour :
- ‚ùå Corrections mineures (couleur, padding)
- ‚ùå Composants shadcn/ui standards (d√©j√† design√©s)
- ‚ùå Ajustements techniques (fix bugs, optimisations)

##### Processus

Design (toi, Figma) ‚Üí partage lien + composant cibl√© ‚Üí impl√©mentation (moi/toi, shadcn + Tailwind) ‚Üí validation ensemble ‚Üí mise √† jour ROADMAP + FRONTEND.md. **Design system** : A-COLD-WALL*, Geist, palette Reboul, shadcn base. **Export Figma** : ne pas copier-coller ; Figma = r√©f√©rence visuelle, recoder en React/shadcn/Tailwind.

##### Bonnes pratiques Figma

‚úÖ **√Ä FAIRE** :
- Nommer clairement les layers (ex: `Button/Primary`, `Form/Input`)
- Utiliser Auto Layout partout (facilite compr√©hension structure)
- Cr√©er des composants r√©utilisables (Design System)
- Utiliser variables de couleurs (coh√©rence)
- Designer mobile-first (comme notre code)

‚ùå **√Ä √âVITER** :
- Designs trop complexes (difficile √† coder)
- Positions absolues partout (pr√©f√©rer flexbox/grid)
- Trop d'effets custom (ombres complexes, gradients multiples)
- Oublier les √©tats (hover, active, disabled, error)

#### üß© Modes de d√©veloppement Frontend

- **Mode p√©dagogique** (par d√©faut) : Tu ne codes pas, tu m'apprends
  - **Processus** :
    1. Tu me donnes le code √† √©crire avec des explications d√©taill√©es
    2. Tu m'expliques ce qu'on fait et pourquoi
    3. Je code les fichiers moi-m√™me
    4. Tu v√©rifies mon code une fois termin√©
    5. On corrige ensemble jusqu'√† r√©ussir
  
  - **Exception - Biblioth√®ques de composants** :
    - Si j'utilise shadcn/ui, Material-UI, etc.
    - Tu me dis quels composants/imports sont n√©cessaires
    - Je te les fournis
    - Tu les int√®gres dans le code

- **Mode normal** : Tu peux modifier les fichiers √† ma place comme normalement
  - √Ä utiliser uniquement si je te le demande explicitement
  - **Cas d'usage** : Pages complexes, composants avec logique m√©tier, int√©gration API

### üì¶ Workflow Collection R√©elle

**Document principal** : `docs/COLLECTION_REAL.md`  
**Commande Cursor** : `/collection-workflow`

#### Approche actuelle

**Import manuel via tables/CSV** : Collections re√ßues une √† une sous forme de table (Excel/CSV), entr√©e manuelle des donn√©es une √† une via Admin.

#### Workflow global

1. R√©ception Collection (Table Excel/CSV)
2. Pr√©paration & Validation Donn√©es
3. Import via Admin (Upload fichier)
4. Validation & Correction
5. Upload Images Produits
6. Publication Collection

#### Format table/CSV attendu

**Colonnes requises** :
- `name` (obligatoire) : Nom du produit
- `reference` (recommand√©) : R√©f√©rence/SKU produit
- `price` (obligatoire) : Prix en euros
- `brand` (recommand√©) : Nom de la marque
- `category` (obligatoire) : Nom de la cat√©gorie
- `collection` (obligatoire) : Nom collection
- `color` (obligatoire) : Couleur du variant
- `size` (obligatoire) : Taille du variant
- `stock` (obligatoire) : Stock disponible
- `sku` (obligatoire) : SKU unique par variant

**Note** : Un produit peut avoir plusieurs lignes (une par variant : couleur + taille)

#### Processus validation

- **Avant import** : V√©rifier format, colonnes, donn√©es compl√®tes, formats corrects
- **Pendant import** : G√©rer erreurs bloquantes et warnings
- **Apr√®s import** : V√©rifier produits cr√©√©s, stocks coh√©rents

#### Points d'attention

- **Variants complexes** : Chaussures (couleurs multiples, tailles diff√©rentes), pantalons (tailles italiennes)
- **Stocks** : Gestion manuelle, alerte r√©assort 0-5 unit√©s (√† impl√©menter)
- **Collections** : Rotation automatique (nouvelle collection remplace l'ancienne)

### üîÑ Int√©gration AS400

**Document d'analyse** : `docs/AS400_ANALYSIS_GUIDE.md`  
**Commande Cursor** : `/as400-integration`  
**Statut** : ‚ö†Ô∏è **EN SUSPENS** - Trop de temps n√©cessaire

#### Approche alternative

**Import manuel via tables/CSV** adopt√© (voir Workflow Collection R√©elle ci-dessus).

#### Exploration effectu√©e

- Interface AS400 explor√©e (Menu principal ‚Üí Option 22 "Recherche article")
- Structure colonnes identifi√©e (Code, Marque, R√©f√©rence, DPT, etc.)
- IP/Port not√©s (192.168.110.200:23)
- Pas d'export CSV direct visible
- N√©cessite m√©thode d'extraction (CSV export, ODBC/JDBC, ou autre)

#### Si reprise future

1. Analyser structure compl√®te AS400
2. Identifier m√©thode d'extraction
3. Cr√©er script transformation AS400 ‚Üí notre structure
4. Impl√©menter import donn√©es

### üì∏ Workflow Images Produits

**Document principal** : `docs/integrations/IMAGES_WORKFLOW.md`  
**Commande Cursor** : `/images-workflow`

#### Processus actuel

1. **Shooting** : √Ä Aubagne au stock, r√©cup√©ration mat√©riel chez le patron
2. **Retouche** : Photoshop (correction couleur, d√©tourage, ajustements)
3. **Nommage** : Convention `[SKU]_[numero]_[type].jpg`
4. **Upload** : Cloudinary via Admin (max 7 images par produit)

#### Standards qualit√©

- **R√©solution** : 2048x2048px (ou 2048x1536px)
- **Poids** : 200-300KB
- **Format** : JPG (qualit√© 85-90%) ou PNG si transparence
- **Espace couleur** : sRGB
- **Quantit√©** : 3-5 images par produit

#### Optimisation automatique

- **Cron job quotidien** (3h) : Nouvelles images 24h ‚Üí WebP
- **Cron job hebdomadaire** (dimanche 4h) : Toutes les images ‚Üí WebP
- **Endpoints manuels** : D√©clencher optimisation si n√©cessaire

#### Convention nommage

**Format** : `[SKU]_[numero]_[type].jpg`

**Exemples** :
- `REB001_1_main.jpg` : Image principale
- `REB001_2_back.jpg` : Vue de dos
- `REB001_3_detail.jpg` : D√©tail

**Structure dossiers** : `products/[collection]/[sku]/`

### Git / Version Control

**R√©f√©rence** : `docs/GIT_WORKFLOW.md` (workflow, conflits, release).

**Conventions** : Branches `feature/`, `fix/`, `hotfix/`, `refactor/`, `docs/`. Commits `type: description` (feat, fix, docs, style, refactor, test, chore) ; 50 car. max ; optionnel `Closes #n`. PR avant merge sur `main`.

### Phase Design / Webdesign (Figma - Outil principal)

**Outil principal** : **Figma** (20‚Ç¨/mois - compte complet)

- **Mode guide & conseiller** : Tu me guides dans ma r√©flexion et ma cr√©ation
  
  **Mon r√¥le** :
  1. **R√©pondre √† tes questions** : Technique Figma, workflow, bonnes pratiques design
  2. **Te donner des astuces** : Raccourcis Figma, plugins utiles, Auto Layout, composants
  3. **Te fournir des ressources** : Tutoriels Figma, exemples, templates Figma pertinents
  4. **Te situer** : O√π tu en es dans `docs/context/ROADMAP_COMPLETE.md`, quelle page designer maintenant
  5. **R√©fl√©chir avec toi** : D√©cisions design (UX/UI, couleurs, typo, layouts)
  6. **Valider tes avanc√©es** : Feedback sur tes designs, suggestions d'am√©lioration
  7. **Conseils techniques** : Comment structurer pour faciliter le code (Auto Layout, naming)
  
  **Processus Design** :
  1. Tu me dis ce que tu veux designer (page Login, Checkout, Admin, etc.)
  2. Je te guide avec conseils, astuces, ressources Figma
  3. Tu cr√©es/designs dans Figma (je ne le fais pas √† ta place)
  4. Tu me partages le lien Figma
  5. Je te donne feedback, suggestions, ou te guide pour la suite
  6. Une fois valid√©, je code en me basant sur ton design
  7. On ajuste ensemble si besoin
  
  **Ce que je NE fais PAS** :
  - ‚ùå Je ne cr√©e pas les maquettes √† ta place
  - ‚ùå Je n'exporte pas le code depuis Figma
  - ‚ùå Je ne designe pas les composants pour toi
  - ‚ùå Je n'utilise pas l'export Figma tel quel dans le code
  
  **Ce que je FAIS** :
  - ‚úÖ Guide et conseils Figma
  - ‚úÖ R√©ponses aux questions techniques design
  - ‚úÖ Ressources et exemples (Figma Community, templates)
  - ‚úÖ Validation et feedback sur tes designs
  - ‚úÖ Orientation dans la roadmap (quelle page designer maintenant)
  - ‚úÖ Conseils pour faciliter l'impl√©mentation code
  - ‚úÖ Impl√©mentation code propre en me basant sur ton design Figma

## Personnalisation par projet

Pour adapter ces r√®gles √† un projet sp√©cifique, modifiez les sections ci-dessus selon :
- Le type de projet (web, mobile, desktop, etc.)
- Les frameworks/biblioth√®ques utilis√©s
- Les pr√©f√©rences d'apprentissage du d√©veloppeur

## Documentation du projet

### Fichiers de contexte √† maintenir

- **ARCHITECTURE_ADMIN_CENTRAL.md** : `docs/architecture/ARCHITECTURE_ADMIN_CENTRAL.md` - Architecture compl√®te Admin Centralis√©e (3 projets + 1 admin) ‚≠ê **R√âF√âRENCE ARCHITECTURE**
- **CONTEXT.md** : `docs/context/CONTEXT.md` - Contexte g√©n√©ral du projet, architecture globale, √©tat actuel
- **ROADMAP_COMPLETE.md** : `docs/context/ROADMAP_COMPLETE.md` - Roadmap d√©taill√©e de toutes les phases (24 phases) - **R√âF√âRENCE PRINCIPALE**
- **BRAINSTORMING_ROADMAP.md** : `docs/context/BRAINSTORMING_ROADMAP.md` - Brainstorming & d√©cisions prises
- **CLARIFICATIONS_BRAINSTORMING.md** : `docs/context/CLARIFICATIONS_BRAINSTORMING.md` - Clarifications et d√©cisions valid√©es
- **API_CONFIG.md** : `docs/context/API_CONFIG.md` - Configuration API centralis√©e (ports, endpoints, variables d'environnement, conventions)
- **frontend/FRONTEND.md** : `frontend/FRONTEND.md` - Documentation frontend (pages, composants, services, √©tat actuel, roadmap frontend)
- **frontend/AUTH_USAGE.md** : `frontend/AUTH_USAGE.md` - Documentation syst√®me authentification frontend (useAuth, AuthContext)
- **backend/BACKEND.md** : `backend/BACKEND.md` - Documentation backend (modules, endpoints, entit√©s, √©tat actuel, roadmap backend)
- **POLICIES_TODO.md** : `docs/context/POLICIES_TODO.md` - Note pour finaliser politiques livraison/retour
- **ANIMATIONS_GUIDE.md** : `docs/animations/ANIMATIONS_GUIDE.md` - Guide complet des animations AnimeJS (workflow, exemples, bonnes pratiques) ‚≠ê **R√âF√âRENCE ANIMATIONS**

### üéØ R√®gle ROADMAP_COMPLETE.md - OBLIGATOIRE

**ROADMAP_COMPLETE.md est la r√©f√©rence principale du projet.**

#### Quand mettre √† jour ROADMAP_COMPLETE.md ?

1. **√Ä CHAQUE √©tape compl√©t√©e** : Cocher `[ ]` ‚Üí `[x]` imm√©diatement
2. **Pour la Phase 24.10 (Images IA)** : En plus de cocher les t√¢ches, mettre √† jour la ligne ¬´ √âtat actuel (derni√®re MAJ) ¬ª dans la section 24.10, et tenir √† jour `docs/integrations/IMAGES_IA_WORKFLOW.md` (statut, prochaine √©tape) pour que l‚Äôavancement soit lisible
3. **√Ä CHAQUE phase termin√©e** : Ajouter ‚úÖ au titre de la phase
4. **Avant de commencer une nouvelle phase** : V√©rifier ROADMAP_COMPLETE.md pour savoir quoi faire
5. **Apr√®s chaque session de travail** : Mettre √† jour l'avancement

#### Comment mettre √† jour ?

```markdown
### Phase 9 : Backend - Authentification & Utilisateurs ‚úÖ
#### 9.1 Entit√© User
- [x] Cr√©er entit√© User (id, email, password hash, ...)
- [x] Enum UserRole (CLIENT, ADMIN, SUPER_ADMIN)
- [x] Cr√©er entit√© Address (id, userId, ...)
```

#### Processus syst√©matique

1. **Avant de commencer une t√¢che** :
   - ‚úÖ Consulter ROADMAP_COMPLETE.md
   - ‚úÖ Identifier la phase et l'√©tape en cours
   - ‚úÖ V√©rifier les d√©pendances

2. **Pendant le d√©veloppement** :
   - ‚úÖ Se r√©f√©rer √† ROADMAP_COMPLETE.md pour la liste des t√¢ches
   - ‚úÖ Noter mentalement ce qui est fait

3. **Apr√®s CHAQUE t√¢che compl√©t√©e** :
   - ‚úÖ **OBLIGATOIRE** : Mettre √† jour ROADMAP_COMPLETE.md (cocher `[x]`)
     - **‚≠ê RECOMMAND√â** : Utiliser le CLI Python (`./rcli roadmap update --task "..."`)
     - Alternative manuelle : √âditer directement le fichier
   - ‚úÖ Mettre √† jour CONTEXT.md (√©tat actuel) si fin de phase
     - **‚≠ê RECOMMAND√â** : Utiliser le CLI Python (`./rcli docs sync`) - synchronise automatiquement ROADMAP ‚Üî BACKEND.md ‚Üî FRONTEND.md
     - Alternative manuelle : √âditer directement le fichier
   - ‚úÖ Mettre √† jour FRONTEND.md ou BACKEND.md si n√©cessaire
     - **‚≠ê RECOMMAND√â** : Utiliser le CLI Python (`./rcli docs sync`) - synchronise automatiquement

#### Importance critique

- **ROADMAP_COMPLETE.md = source de v√©rit√© du projet**
- Permet de savoir exactement o√π on en est √† tout moment
- Facilite la reprise apr√®s pause
- √âvite les oublis et les doublons
- Assure la coh√©rence du d√©veloppement

### R√®gles de maintenance g√©n√©rales

- **Mise √† jour continue** : Maintenir ces fichiers √† jour tout au long du projet
- **Travail par √©tapes** : Documenter chaque √©tape au fur et √† mesure du d√©veloppement
- **√âtat actuel** : Toujours mettre √† jour la section "√âtat Actuel" apr√®s chaque fonctionnalit√©
- **Versioning** : Mettre √† jour les num√©ros de version et phases dans chaque fichier
- **D√©tails techniques** : Documenter les nouvelles fonctionnalit√©s, endpoints, composants, etc.
- **Roadmaps** : Maintenir les roadmaps frontend et backend √† jour :
  - Cocher les √©l√©ments termin√©s dans les roadmaps
  - Ajouter les nouvelles fonctionnalit√©s planifi√©es
  - Mettre √† jour les phases et priorit√©s
  - **Synchroniser avec ROADMAP_COMPLETE.md (prioritaire)**

### Processus de documentation

**Avant** : Consulter `ROADMAP_COMPLETE.md` (obligatoire), `ARCHITECTURE_ADMIN_CENTRAL.md` si admin, `CONTEXT.md` / `FRONTEND.md` ou `BACKEND.md` selon le contexte.  
**Apr√®s chaque √©tape** : Cocher t√¢ches dans `ROADMAP_COMPLETE.md` (`./rcli roadmap update --task "..."`), lancer `./rcli docs sync` pour CONTEXT / FRONTEND / BACKEND.

### üîí R√®gle : Gestion des fichiers MD temporaires

**PROBL√àME** : Des fichiers MD temporaires (diagnostics, solutions, v√©rifications ponctuelles) sont cr√©√©s et laiss√©s dans la documentation, devenant obsol√®tes.

**R√àGLE OBLIGATOIRE** :

#### ‚ùå Ne PAS cr√©er de fichiers MD temporaires dans `docs/`

**Types de fichiers √† √©viter** :
- `DIAGNOSTIC_*.md` - Diagnostics de probl√®mes
- `SOLUTION_*.md` - Solutions de probl√®mes r√©solus
- `VERIFICATION_*.md` - V√©rifications ponctuelles
- `CONTEXTE_IA_*.md` - Confirmations ponctuelles
- `FILES_TO_REVIEW.md` - Analyses ponctuelles
- `*_PLAN.md` - Plans temporaires (sauf dans `docs/phases/` pour phases actives)
- `*_RESUME.md` - R√©sum√©s temporaires (sauf dans `docs/phases/` pour phases actives)

#### ‚úÖ Alternatives recommand√©es

**Pour les diagnostics/solutions** :
1. **Documenter dans le chat** : Expliquer le probl√®me et la solution directement
2. **Mettre √† jour la documentation existante** : Si le probl√®me est r√©current, ajouter une section dans la doc pertinente (ex: `docs/server/` pour probl√®mes serveur)
3. **Si vraiment n√©cessaire** : Cr√©er dans `docs/archive/` avec date et supprimer apr√®s r√©solution

**Pour les v√©rifications ponctuelles** :
- Faire la v√©rification dans le chat
- Mettre √† jour directement les fichiers concern√©s si n√©cessaire
- Ne pas cr√©er de fichier d√©di√©

**Pour les plans/r√©sum√©s de phases** :
- ‚úÖ **Autoris√©** : `docs/phases/PHASE_X_PLAN.md` et `docs/phases/PHASE_X_RESUME.md` pour phases **actives**
- ‚ùå **Interdit** : Cr√©er ces fichiers pour phases termin√©es
- ‚úÖ **Action** : Archiver dans `docs/archive/` une fois la phase termin√©e

#### üì¶ Archivage des fichiers obsol√®tes

**Quand archiver** :
- Probl√®me r√©solu (diagnostic/solution)
- V√©rification termin√©e
- Phase termin√©e (plan/r√©sum√©)

**Comment archiver** :
```bash
# D√©placer dans docs/archive/
mv docs/DIAGNOSTIC_*.md docs/archive/
mv docs/SOLUTION_*.md docs/archive/
mv docs/phases/PHASE_X_*.md docs/archive/  # Si phase termin√©e
```

**Documentation de l'archive** :
- Mettre √† jour `docs/archive/README.md` avec la raison de l'archivage
- Ajouter la date d'archivage

#### ‚úÖ Fichiers MD permanents autoris√©s

**Dans `docs/`** :
- Guides et workflows (`GIT_WORKFLOW.md`, `ANIMATIONS_GUIDE.md`, etc.)
- Documentation architecture (`ARCHITECTURE_*.md`)
- Documentation serveur (`PRODUCTION_SECURITY.md`, `BACKUP_AND_LOGS.md`, etc.)
- Documentation int√©grations (`STRIPE_*.md`, `GA4_*.md`, `CLOUDFLARE_*.md`, etc.)
- Index et README (`README.md`, `CONTEXT_INDEX.md`, etc.)

**Dans `docs/phases/`** :
- R√©capitulatifs de phases (`PHASE_X_RECAP.md`) - **√Ä garder** (historique utile)
- Checklists de completion (`PHASE_X_COMPLETION.md`) - **√Ä garder** (r√©f√©rence)
- Synth√®ses et FAQ pour phases actives (`PHASE_X_SYNTHESE.md`, `PHASE_X_FAQ_*.md`) - **√Ä garder**

**Dans `docs/context/`** :
- Fichiers de contexte permanents (`CONTEXT.md`, `ROADMAP_COMPLETE.md`, `API_CONFIG.md`, etc.)

#### üéØ R√®gle d'or

**Si le fichier MD sert √† r√©soudre un probl√®me ponctuel ou documenter une v√©rification temporaire** :
- ‚ùå **NE PAS le cr√©er dans `docs/`**
- ‚úÖ **Documenter dans le chat ou mettre √† jour la doc existante**
- ‚úÖ **Si vraiment n√©cessaire, cr√©er dans `docs/archive/` et supprimer apr√®s r√©solution**

## üöÄ CLI Python - Automatisation & Gestion Serveur (PR√äT POUR PRODUCTION)

Le projet dispose d'un **CLI Python complet** pour automatiser toutes les t√¢ches r√©p√©titives ET g√©rer le serveur VPS :

### Installation

```bash
cd cli
./setup.sh
source venv/bin/activate
```

### ‚ö° Wrapper Script (Recommand√©)

Utiliser `./rcli` √† la racine du projet (wrapper automatique) :

```bash
# Au lieu de : python cli/main.py ...
./rcli server status
./rcli logs errors
./rcli db backup --server
```

Le projet dispose d'un **CLI Python complet** pour automatiser toutes les t√¢ches r√©p√©titives :

### Installation

```bash
cd cli
./setup.sh
source venv/bin/activate
```

### üéØ Utilisation recommand√©e (Workflow quotidien)

#### Avant de commencer une session
```bash
# G√©n√©rer le contexte √† jour pour Cursor
./rcli context generate

# V√©rifier l'√©tat de la roadmap
./rcli roadmap check

# V√©rifier l'√©tat du serveur
./rcli server status
./rcli server monitor --once
```

#### G√©n√©ration de code Backend
```bash
# Module complet (Entity + DTOs + Service + Controller + Module)
./rcli code generate module FeatureName --full

# Composants individuels
./rcli code generate entity Category
./rcli code generate dto Product create
./rcli code generate service Product
./rcli code generate controller Product
```

#### G√©n√©ration de code Frontend
```bash
# Composants React
./rcli code component ProductCard --domain Product
./rcli code component Button --shadcn --use card button

# Pages compl√®tes
./rcli code page Checkout --entity Order

# Hooks et services
./rcli code hook useProducts
./rcli code api-service products

# Animations AnimeJS
./rcli code animation fadeIn --type fade
```

#### Tests
```bash
./rcli test generate e2e products
./rcli test generate unit ProductsService
./rcli test generate functional upload-images
```

#### Base de donn√©es
```bash
./rcli db generate migration AddUserTable
./rcli db generate seed initial-data --entities Category Product
./rcli db analyze schema

# Backups DB (serveur)
./rcli db backup --server
./rcli db backup-list
./rcli db backup-restore <backup_file> --yes
```

#### Documentation
```bash
# G√©n√©rer documentation API et composants
./rcli docs generate api
./rcli docs generate components

# Synchroniser ROADMAP ‚Üî BACKEND.md ‚Üî FRONTEND.md
./rcli docs sync

# G√©n√©rer changelog
./rcli docs changelog

# Valider la documentation
./rcli docs validate
```

#### Analyse et suggestions
```bash
# Analyser patterns et code dupliqu√©
./rcli analyze patterns

# Analyser la verbosit√© du code (commentaires redondants, r√©p√©titions)
# D√©tecte automatiquement les violations de la r√®gle primordiale d'√©criture du code
./rcli analyze verbosity
./rcli analyze verbosity --file frontend/src/pages/Home.tsx
./rcli analyze verbosity --dir frontend/src/pages

# Valider la coh√©rence du code
./rcli analyze code

# Analyser le code mort
./rcli analyze dead-code

# Sugg√©rer des phases
./rcli suggest phase
./rcli suggest phase auth

# Optimiser le contexte
./rcli context optimize
```

**Note** : La commande `analyze verbosity` d√©tecte automatiquement :
- ‚úÖ Commentaires redondants (qui expliquent l'√©vident)
- ‚úÖ Code r√©p√©titif (patterns similaires 3+ fois)
- ‚úÖ Blocs dupliqu√©s (code identique)
- ‚úÖ Fonctions verbeuses (>30% de commentaires)

Elle s'aligne avec la **r√®gle primordiale d'√©criture du code** : √©viter la verbosit√© excessive.

#### Gestion shadcn/ui et Figma
```bash
# Lister/installer composants shadcn/ui
./rcli shadcn list
./rcli shadcn install button card

# Analyser et sugg√©rer depuis Figma
./rcli figma analyze [url]
./rcli figma suggest [url]
```

#### Apr√®s chaque t√¢che compl√©t√©e
```bash
# Cocher la t√¢che dans la roadmap
./rcli roadmap update --task "15.1 Configuration Cloudinary"

# Si phase compl√®te
./rcli roadmap update --phase 15 --complete

# Synchroniser la documentation
./rcli docs sync
```

### üìä Impact et gains

| T√¢che | Avant | Apr√®s | Gain |
|-------|-------|-------|------|
| Mise √† jour roadmap | 3 min | 5 sec | **97%** |
| Cr√©ation module complet | 60 min | 5 min | **92%** |
| Cr√©ation composant | 15 min | 1 min | **93%** |
| Synchronisation docs | 10 min | 1 sec | **99%** |
| G√©n√©ration tests | 65 min | 4 min | **94%** |
| Analyse compl√®te | 75 min | 4 min | **95%** |
| Analyse verbosit√© | 20 min | 10 sec | **99%** |

**Temps √©conomis√©** : ~15-20 heures par semaine  
**R√©duction d'erreurs** : ~90%

### üìö Documentation CLI

- **Commande Cursor** : `/cli-workflow` (guide complet) ‚≠ê
- **R√©capitulatif** : `cli/RECAPITULATIF.md` (√©tat actuel complet) ‚≠ê
- **Fichiers** : `cli/README.md`, `cli/USAGE.md`, `cli/ROADMAP.md`, `cli/CONTEXT.md`

### ‚úÖ √âtat actuel

**Phases compl√©t√©es** : 8/10 (Phase 1-8)
- ‚úÖ Phase 1 : Fondations
- ‚úÖ Phase 2 : G√©n√©ration code Backend
- ‚úÖ Phase 3 : G√©n√©ration code Frontend
- ‚úÖ Phase 4 : Analyse et validation
- ‚úÖ Phase 5 : G√©n√©ration de tests
- ‚úÖ Phase 6 : Migrations et base de donn√©es
- ‚úÖ Phase 7 : Documentation automatique
- ‚úÖ Phase 8 : Intelligence et suggestions

**Le CLI est pr√™t pour la production !** üéâ

### üîß R√®gles CLI - IMPORTANT

#### R√©paration automatique des erreurs

**L'IA DOIT automatiquement r√©parer les erreurs du CLI** :

1. **D√©tection d'erreur** :
   - Si une commande CLI √©choue (erreur Python, import, syntaxe)
   - Si un fichier g√©n√©r√© est incorrect
   - Si un template ne fonctionne pas

2. **Action imm√©diate** :
   - ‚úÖ **R√©parer automatiquement** sans demander
   - ‚úÖ Analyser l'erreur et corriger le code
   - ‚úÖ Tester la correction
   - ‚úÖ Informer l'utilisateur de la correction effectu√©e

3. **Exemples de corrections automatiques** :
   - Erreur d'import ‚Üí Corriger les chemins
   - Erreur de template Jinja2 ‚Üí Corriger la syntaxe
   - Fichier manquant ‚Üí Cr√©er le fichier n√©cessaire
   - Erreur de type ‚Üí Corriger les types Python

4. **Communication** :
   - Informer l'utilisateur : "üîß Erreur d√©tect√©e et corrig√©e automatiquement"
   - Expliquer bri√®vement ce qui a √©t√© corrig√©
   - Continuer avec la t√¢che demand√©e

#### Utilisation du CLI

- **Toujours utiliser le CLI** pour les t√¢ches r√©p√©titives
- **Pr√©f√©rer le CLI** √† la modification manuelle des fichiers
- **Documenter** les nouvelles fonctionnalit√©s CLI dans `cli/ROADMAP.md`

### üñ•Ô∏è CLI - Gestion Serveur VPS (PRODUCTION)

Le CLI dispose d'un **arsenal complet de commandes** pour g√©rer et surveiller le serveur VPS de production.

#### üìã Commandes Serveur (`server`)

**Statut et monitoring** :
```bash
# √âtat des containers (Reboul Store + Admin Central)
./rcli server status
./rcli server status --all
./rcli server status --admin  # Admin Central uniquement
./rcli server status --watch  # Mode watch (temps r√©el)

# Ressources syst√®me (CPU, RAM, disque, r√©seau)
./rcli server resources

# Monitoring continu avec seuils
./rcli server monitor
./rcli server monitor --once
./rcli server monitor --cpu-threshold 70 --ram-threshold 85
```

**Logs** :
```bash
# Logs de tous les services
./rcli server logs
./rcli server logs backend
./rcli server logs --follow  # Suivre en temps r√©el
./rcli server logs --errors  # Filtrer uniquement les erreurs
./rcli server logs --tail 200
./rcli server logs --admin  # Admin Central

# Recherche avanc√©e dans les logs
./rcli logs errors --last 1h
./rcli logs search "ERROR" --last 1h
./rcli logs api-errors --last 1h  # Erreurs API (4xx, 5xx)
./rcli logs slow-requests --threshold 2.0  # Requ√™tes lentes
./rcli logs user-activity --last 1h --top 20  # Activit√© utilisateurs
```

**Gestion des services** :
```bash
# Red√©marrer un service
./rcli server restart
./rcli server restart backend
./rcli server restart --admin

# Liste d√©taill√©e des containers
./rcli server ps
./rcli server ps --admin

# Nettoyer Docker
./rcli server cleanup --volumes
./rcli server cleanup --images
./rcli server cleanup --all --yes
```

**Variables d'environnement** :
```bash
# V√©rifier les fichiers .env
./rcli server env --check

# Backup des fichiers .env
./rcli server env --backup
```

#### üîê S√©curit√© et Certificats

```bash
# V√©rifier l'expiration des certificats SSL
./rcli server ssl --check
./rcli server ssl --check --domain reboulstore.com
./rcli server ssl --check --admin

# Audit de s√©curit√© complet
./rcli server security --audit
```

**V√©rifications de s√©curit√©** :
- Ports ouverts
- Permissions des fichiers sensibles (.env, cl√©s SSL)
- Certificats SSL (expiration)
- Mises √† jour de s√©curit√© disponibles
- Configuration firewall (UFW/iptables)
- Conteneurs Docker actifs

#### ‚è∞ Gestion des Cron Jobs

```bash
# Lister tous les cron jobs
./rcli server cron --list

# Activer le backup automatique de la DB (quotidien √† 2h)
./rcli server cron --enable-backup

# D√©sactiver le backup automatique
./rcli server cron --disable-backup

# Ajouter un cron job personnalis√©
./rcli server cron --add "0 3 * * * /path/to/script.sh" --description "Mon script quotidien"

# Supprimer un cron job
./rcli server cron --remove 1
```

#### üìÅ Gestion des fichiers (upload/download)

```bash
# Uploader un fichier
./rcli server file --upload ./image.jpg /var/www/reboulstore/uploads/image.jpg

# T√©l√©charger un fichier
./rcli server file --download /var/log/nginx/error.log ./logs/error.log

# Lister les fichiers d'un r√©pertoire
./rcli server file --list /var/www/reboulstore/backups

# Backup d'un r√©pertoire (ex: uploads)
./rcli server file --backup uploads

# Backup complet (uploads + configs)
./rcli server file --backup-all
```

#### üñ•Ô∏è Ex√©cuter des commandes SSH

```bash
# Ex√©cuter une commande simple
./rcli server exec "df -h"

# Ex√©cuter une commande dans un r√©pertoire sp√©cifique
./rcli server exec "ls -la" --cwd /var/www/reboulstore

# Voir les containers Docker
./rcli server exec "docker ps"
```

#### üåê V√©rification DNS/Propagation

```bash
# V√©rifier les enregistrements DNS d'un domaine
./rcli server dns --check reboulstore.com

# V√©rifier la propagation DNS pour tous les domaines
./rcli server dns --propagate
```

#### üíæ Backup et Rollback

```bash
# Backup complet du syst√®me (DB + fichiers + configs)
./rcli server backup --full

# Lister les backups disponibles
./rcli server rollback --list

# Rollback vers un backup sp√©cifique
./rcli server rollback --to 20250129_120000

# Rollback vers le dernier backup
./rcli server rollback --latest
./rcli server rollback --latest --db-only  # DB uniquement
./rcli server rollback --latest --yes  # Sans confirmation
```

#### üè• Health Check

```bash
# V√©rifier la sant√© de tous les services
./rcli health check
./rcli health check --service reboul
./rcli health check --service admin

# √âtat des containers Docker
./rcli health containers
```

#### üöÄ D√©ploiement

```bash
# V√©rifier que le d√©ploiement fonctionne
./rcli deploy check
./rcli deploy check --service reboul
./rcli deploy check --service admin

# D√©ployer les services
./rcli deploy deploy
./rcli deploy deploy --service reboul
./rcli deploy deploy --service admin
./rcli deploy deploy --build  # Rebuild les images
./rcli deploy deploy --pull  # Pull git avant d√©ploiement

# Mettre √† jour le code depuis git et red√©marrer
./rcli deploy update
./rcli deploy update --pull
./rcli deploy update --rebuild
```

#### üéØ Workflows Recommand√©s

**Avant un d√©ploiement** :
```bash
# 1. V√©rifier l'√©tat des ressources
./rcli server monitor --once

# 2. Faire un backup complet
./rcli server backup --full

# 3. V√©rifier les logs d'erreurs
./rcli logs errors --last 1h

# 4. V√©rifier la s√©curit√©
./rcli server security --audit
```

**Apr√®s un d√©ploiement** :
```bash
# 1. V√©rifier que tout fonctionne
./rcli server status
./rcli logs api-errors --last 5m

# 2. Monitorer les ressources
./rcli server monitor --interval 30

# 3. Si probl√®me, rollback rapide
./rcli server rollback --list
./rcli server rollback --latest
```

**Maintenance quotidienne** :
```bash
# V√©rifier les certificats SSL (1x par semaine)
./rcli server ssl --check

# V√©rifier les cron jobs
./rcli server cron --list

# Audit de s√©curit√© (1x par mois)
./rcli server security --audit

# V√©rifier l'espace disque
./rcli server exec "df -h"
```

**Maintenance hebdomadaire** :
```bash
# V√©rifier les ressources
./rcli server monitor --once

# V√©rifier les backups
./rcli db backup-list
./rcli server rollback --list

# Analyser l'activit√©
./rcli logs user-activity --last 7d

# V√©rifier les requ√™tes lentes
./rcli logs slow-requests --last 7d
```

#### üìö Documentation CLI Serveur

- **CLI_SERVER_COMMANDS.md** : `cli/CLI_SERVER_COMMANDS.md` - Toutes les commandes serveur ‚≠ê
- **CLI_SERVER_USAGE.md** : `docs/cli/CLI_SERVER_USAGE.md` - Guide d'utilisation complet
- **CLI_VPS_COMMANDS.md** : `docs/cli/CLI_VPS_COMMANDS.md` - Commandes VPS d√©taill√©es
- **RECAPITULATIF.md** : `cli/RECAPITULATIF.md` - R√©capitulatif complet du CLI

#### ‚öôÔ∏è Configuration Requise

Les commandes n√©cessitent :
- Configuration SSH vers le serveur (d√©finie dans `SERVER_CONFIG`)
- Acc√®s au serveur VPS
- Docker et Docker Compose install√©s sur le serveur

**Variables d'environnement** (optionnelles) :
```bash
export VPS_HOST=152.228.218.35
export VPS_USER=deploy
export VPS_SSH_KEY=~/.ssh/id_rsa
```

Voir `cli/utils/server_helper.py` pour la configuration.

---

## üîß Project Commands Cursor

**Commandes disponibles dans Cursor** : Utiliser avec `/nomcommande` dans le chat

### Commandes de contexte et workflow

- **`/getcontext [sujet]`** : Recherche rapide de contexte dans le projet
  - Liste tous les fichiers de r√©f√©rence (ROADMAP, ARCHITECTURE, etc.)
  - Guide de recherche par domaine fonctionnel
  - Aide √† trouver la documentation pertinente

- **`/frontend-workflow`** : Workflow complet frontend
  - Cr√©ation de pages, composants, services
  - Structure des fichiers, conventions de code
  - Styling TailwindCSS, responsive
  - Int√©gration animations GSAP

- **`/backend-workflow`** : Workflow complet backend
  - Cr√©ation de modules NestJS
  - Entit√©s TypeORM, DTOs
  - Endpoints API, authentification
  - Base de donn√©es, migrations

- **`/figma-workflow`** : Workflow Figma ‚Üí Frontend
  - Processus complet design ‚Üí code
  - Conventions design system
  - Plugins Figma recommand√©s
  - Conversion Figma ‚Üí TailwindCSS

- **`/animation-workflow`** : Workflow animations AnimeJS
  - Cr√©ation d'animations r√©utilisables
  - Structure animations/, presets/, components/
  - Utilisation hooks, constantes
  - Bonnes pratiques AnimeJS

- **`/documentation-workflow`** : Workflow documentation
  - Quand et comment mettre √† jour les docs
  - Fichiers √† maintenir (ROADMAP, CONTEXT, etc.)
  - Format de documentation
  - Checklist de v√©rification

### Commandes de cr√©ation

**‚≠ê RECOMMAND√â : Utiliser le CLI Python pour la g√©n√©ration de code**

- **`/component-create [nom] [domaine?]`** : Cr√©er un composant React
  - **‚≠ê OU** : `./rcli code component [nom] --domain [domaine]`
  - Template de base avec props typ√©es
  - Bonnes pratiques, documentation
  - Exemples par domaine (UI, Product, etc.)
  - **Avec shadcn/ui** : `./rcli code component [nom] --shadcn --use button card`

- **`/page-create [nom]`** : Cr√©er une page React
  - **‚≠ê OU** : `./rcli code page [nom] --entity [entity]`
  - Template de base avec structure standard
  - Gestion loading/error states
  - Int√©gration routes, services

- **`/module-create [nom]`** : Cr√©er un module NestJS complet
  - **‚≠ê OU** : `./rcli code generate module [nom] --full`
  - Module, Service, Controller
  - DTOs, Entit√©s
  - Enregistrement automatique dans app.module

### Commandes utilitaires

- **`/update-roadmap`** : Mettre √† jour ROADMAP_COMPLETE.md (`docs/context/ROADMAP_COMPLETE.md`)
  - **‚≠ê RECOMMAND√â** : Utiliser le CLI (`./rcli roadmap update --task "..."`)
  - Quand et comment cocher les t√¢ches
  - Format de mise √† jour
  - Processus syst√©matique

- **`/cli-workflow`** : Guide complet du CLI Python ‚≠ê **NOUVEAU**
  - Toutes les commandes disponibles
  - Workflows recommand√©s
  - Exemples d'utilisation
  - Impact et gains de productivit√©

- **`/claude-code-workflow`** : Workflow Toi + Cursor + Claude Code + CLI
  - Quand utiliser Claude Code (batch CLI, docs sync, roadmap, commits) vs rester dans Cursor (code, architecture)
  - Prompts pr√™ts √† coller dans Claude Code (batch images, v√©rif refs, docs sync, commit)
  - R√©f√©rence : `docs/context/CLAUDE_CODE_CURSOR_CONTEXT.md`, `CLAUDE.md`

### üîÑ Workflow Cursor + Claude Code (routage automatique)

**R√®gle** : Pour les t√¢ches **batch / CLI / doc / git** (liste de refs, images generate+upload en masse, `./rcli docs sync`, mise √† jour roadmap, commit de session), **sugg√©rer d'utiliser Claude Code** dans le terminal et fournir un **prompt pr√™t √† coller**.

- **Cursor (moi)** : code, architecture, r√®gles, revue, explications. Je ne peux pas lancer Claude Code.
- **Claude Code** : terminal (`claude` dans le repo), ex√©cute `./rcli`, git, encha√Ænements. Contexte = `CLAUDE.md` + docs.
- **Routage** : Quand l'utilisateur demande une t√¢che du type batch images, v√©rif refs en masse, sync doc, mise √† jour roadmap, ou commit descriptif ‚Üí proposer : ¬´ Pour √ßa, ouvre Claude Code dans le terminal et colle ce prompt : [prompt adapt√©]. ¬ª Utiliser les exemples de `/.cursor/commands/claude-code-workflow.md` ou les adapter.

### Utilisation des commandes

1. **Dans le chat Cursor** : Taper `/nomcommande` pour afficher le guide
2. **R√©f√©rence rapide** : Les commandes contiennent tous les d√©tails du workflow
3. **Contexte partag√©** : Les commandes servent de r√©f√©rence pour maintenir la coh√©rence
4. **Documentation vivante** : Les commandes sont mises √† jour avec les meilleures pratiques

### üîÑ Utilisation automatique par l'IA

**L'IA doit automatiquement utiliser ces commandes comme r√©f√©rence** selon le contexte :

#### Quand utiliser automatiquement `/getcontext`
- ‚úÖ Au d√©but de chaque session ou question complexe
- ‚úÖ Quand l'utilisateur demande "o√π trouver X" ou "comment faire Y"
- ‚úÖ Pour identifier les fichiers de documentation pertinents

#### Quand utiliser automatiquement `/frontend-workflow`
- ‚úÖ Quand l'utilisateur veut cr√©er une page, composant ou service frontend
- ‚úÖ Quand l'utilisateur demande des conventions de code frontend
- ‚úÖ Pour rappeler la structure des fichiers et les bonnes pratiques

#### Quand utiliser automatiquement `/backend-workflow`
- ‚úÖ Quand l'utilisateur veut cr√©er un module, entit√© ou endpoint backend
- ‚úÖ Quand l'utilisateur demande des conventions NestJS/TypeORM
- ‚úÖ Pour rappeler la structure des modules et les patterns

#### Quand utiliser automatiquement `/figma-workflow`
- ‚úÖ Quand l'utilisateur mentionne Figma ou un design
- ‚úÖ Quand l'utilisateur veut impl√©menter un design depuis Figma
- ‚úÖ Pour rappeler le processus design ‚Üí code

#### Quand utiliser automatiquement `/animation-workflow`
- ‚úÖ Quand l'utilisateur veut cr√©er une animation AnimeJS
- ‚úÖ Quand l'utilisateur demande comment animer un √©l√©ment
- ‚úÖ Pour rappeler la structure animations/ et les bonnes pratiques

#### Quand utiliser automatiquement `/component-create`, `/page-create`, `/module-create`
- ‚úÖ Quand l'utilisateur veut cr√©er un nouveau composant/page/module
- ‚úÖ Pour fournir les templates et structures standard
- ‚úÖ Pour rappeler les conventions de nommage et structure

#### Quand utiliser automatiquement `/cli-server-workflow`
- ‚úÖ Quand l'utilisateur demande des informations sur le serveur
- ‚úÖ Quand l'utilisateur veut g√©rer des backups, logs, monitoring
- ‚úÖ Quand l'utilisateur demande comment v√©rifier la s√©curit√©
- ‚úÖ Pour rappeler les workflows de gestion serveur (avant/apr√®s d√©ploiement)
- ‚úÖ Pour fournir les commandes CLI serveur appropri√©es

#### Quand utiliser automatiquement `/claude-code-workflow`
- ‚úÖ Quand l'utilisateur demande un batch (images, v√©rif refs, etc.) ou une t√¢che CLI encha√Æn√©e
- ‚úÖ Quand l'utilisateur demande de synchroniser la doc, mettre √† jour la roadmap, ou faire un commit de session
- ‚úÖ Pour proposer un prompt pr√™t √† coller dans Claude Code (terminal) au lieu d'ex√©cuter soi-m√™me des commandes r√©p√©titives
- ‚úÖ Quand l'utilisateur demande comment faire travailler Cursor et Claude Code ensemble

#### Quand utiliser automatiquement `/update-roadmap` ou `/documentation-workflow`
- ‚úÖ Apr√®s chaque t√¢che compl√©t√©e
- ‚úÖ Quand l'utilisateur demande comment documenter
- ‚úÖ Pour rappeler le processus de mise √† jour de la documentation

#### Processus automatique de l'IA

1. **D√©tecter le contexte** de la demande utilisateur
2. **Identifier les commandes pertinentes** √† consulter
3. **Lire automatiquement** les fichiers `.cursor/commands/[commande].md`
4. **Utiliser le contenu** comme r√©f√©rence pour r√©pondre
5. **R√©f√©rencer les workflows** dans la r√©ponse si pertinent

**L'IA ne doit pas attendre** que l'utilisateur tape `/commande`, elle doit **automatiquement** consulter et utiliser ces commandes selon le contexte.

### Mise √† jour des commandes

- ‚úÖ Les commandes doivent √™tre maintenues √† jour avec les workflows
- ‚úÖ Ajouter de nouvelles commandes pour de nouveaux workflows
- ‚úÖ Les commandes doivent r√©f√©rencer les fichiers de documentation
- ‚úÖ L'IA doit automatiquement utiliser ces commandes selon le contexte

## V√©rification et correction

- Toujours v√©rifier le code apr√®s impl√©mentation
- Corriger ensemble, pas seul
- Expliquer les erreurs et leurs solutions
- S'assurer que le code fonctionne avant de passer √† la suite

## üîí R√®gles de Build et D√©ploiement - OBLIGATOIRES

### üö® WORKFLOW DE D√âPLOIEMENT - R√àGLE CRITIQUE ABSOLUE

**R√àGLE FONDAMENTALE** : **JAMAIS de `docker compose down` ou `docker compose down -v` qui supprime les volumes de base de donn√©es.**

#### ‚ö†Ô∏è INTERDICTIONS ABSOLUES

**JAMAIS ex√©cuter** :
- ‚ùå `docker compose down` (peut supprimer les volumes si mal configur√©)
- ‚ùå `docker compose down -v` (supprime TOUS les volumes, y compris la base de donn√©es)
- ‚ùå `docker volume rm` sur les volumes contenant `postgres`, `db`, `database`
- ‚ùå Supprimer le container PostgreSQL sans pr√©server le volume
- ‚ùå Recr√©er le container PostgreSQL sans pr√©server le volume

#### ‚úÖ WORKFLOW CORRECT DE D√âPLOIEMENT

**1. AVANT TOUT : Sauvegarde automatique de la base de donn√©es**
```bash
# OBLIGATOIRE avant chaque d√©ploiement
./rcli db backup --server
```

**2. Arr√™t des services SANS supprimer les volumes**
```bash
# ‚úÖ CORRECT : Arr√™t sans supprimer les volumes
docker compose -f docker-compose.prod.yml --env-file .env.production down

# ‚ùå INTERDIT : Arr√™t avec suppression des volumes
# docker compose -f docker-compose.prod.yml --env-file .env.production down -v
```

**3. Suppression UNIQUEMENT des volumes de build (frontend_build)**
```bash
# ‚úÖ CORRECT : Supprimer uniquement les volumes de build
docker volume rm reboulstore_frontend_build admin_central_frontend_build 2>/dev/null || true

# ‚ùå INTERDIT : Supprimer les volumes de base de donn√©es
# docker volume rm reboulstore_postgres_prod
# docker volume rm postgres_data_prod
```

**4. Build et red√©marrage**
```bash
# Build des nouvelles images
docker compose -f docker-compose.prod.yml --env-file .env.production build --no-cache frontend backend

# D√©marrage des services (le volume PostgreSQL est pr√©serv√©)
docker compose -f docker-compose.prod.yml --env-file .env.production up -d
```

#### üîí PROTECTION DES VOLUMES DE BASE DE DONN√âES

**Volumes √† JAMAIS supprimer** :
- ‚úÖ `reboulstore_postgres_prod` (ou `postgres_data_prod`)
- ‚úÖ Tous les volumes contenant `postgres`, `db`, `database` dans leur nom
- ‚úÖ V√©rifier AVANT toute suppression : `docker volume ls | grep -E '(postgres|db|database)'`

**V√©rification avant d√©ploiement** :
```bash
# V√©rifier que les volumes de base de donn√©es existent
docker volume ls | grep -E '(postgres|db|database)'

# Si volumes pr√©sents ‚Üí NE PAS les supprimer
# Si volumes absents ‚Üí ERREUR, restaurer depuis backup
```

#### üìã CHECKLIST OBLIGATOIRE AVANT D√âPLOIEMENT

- [ ] **Sauvegarde automatique** : `./rcli db backup --server` ‚úÖ
- [ ] **V√©rification volumes DB** : `docker volume ls | grep postgres` ‚úÖ
- [ ] **Arr√™t services** : `docker compose down` (SANS `-v`) ‚úÖ
- [ ] **Suppression volumes build uniquement** : `docker volume rm frontend_build` ‚úÖ
- [ ] **Build images** : `docker compose build --no-cache` ‚úÖ
- [ ] **D√©marrage services** : `docker compose up -d` ‚úÖ
- [ ] **V√©rification DB** : `docker exec postgres psql -c "SELECT COUNT(*) FROM brand;"` ‚úÖ

#### üö® EN CAS D'ERREUR

**Si la base de donn√©es a √©t√© supprim√©e** :
1. **ARR√äTER IMM√âDIATEMENT** tout d√©ploiement
2. **V√©rifier les backups** : `./rcli db backup-list`
3. **Restaurer depuis backup** : `./rcli db backup-restore <backup_file> --yes`
4. **V√©rifier la restauration** : `docker exec postgres psql -c "SELECT COUNT(*) FROM brand;"`

#### üìö Script de d√©ploiement correct

**Utiliser UNIQUEMENT** : `./scripts/deploy-prod.sh`

Ce script :
- ‚úÖ Sauvegarde automatiquement la base de donn√©es avant d√©ploiement
- ‚úÖ Arr√™te les services SANS supprimer les volumes de base de donn√©es
- ‚úÖ Supprime UNIQUEMENT les volumes de build (frontend_build)
- ‚úÖ V√©rifie que les volumes de base de donn√©es sont pr√©serv√©s
- ‚úÖ Build et red√©marre les services

**JAMAIS ex√©cuter manuellement** :
- ‚ùå `docker compose down -v` (supprime TOUS les volumes)
- ‚ùå `docker volume rm` sur les volumes de base de donn√©es
- ‚ùå Commandes Docker Compose sans `--env-file .env.production`

### Protection fichiers .env.production

**R√àGLE CRITIQUE** : Les fichiers `.env.production` sont **OBLIGATOIRES** pour tous les builds et d√©ploiements.

#### V√©rifications obligatoires avant build

1. **Existence du fichier** :
   - ‚úÖ V√©rifier que `.env.production` existe AVANT chaque build
   - ‚úÖ V√©rifier pour Reboul Store ET Admin Central (si configur√©)
   - ‚ùå **INTERDICTION** de builder sans `.env.production`
   - ‚ùå **INTERDICTION** de builder avec un fichier vide

2. **Sauvegarde automatique** :
   - ‚úÖ Sauvegarder automatiquement `.env.production` avant chaque d√©ploiement
   - ‚úÖ Sauvegardes stock√©es dans `/opt/reboulstore/.env-backups/`
   - ‚úÖ Garder les 10 derniers backups

3. **Coh√©rence architecture** :
   - ‚úÖ **TOUJOURS** appliquer les m√™mes protections √† Reboul Store ET Admin Central
   - ‚úÖ Si une protection est ajout√©e pour un projet, l'ajouter pour l'autre
   - ‚úÖ Architecture globale = m√™me niveau de protection partout

#### Processus obligatoire

**AVANT chaque build** :
1. Sauvegarder les fichiers `.env.production` existants
2. V√©rifier que Reboul Store `.env.production` existe et n'est pas vide
3. V√©rifier que Admin Central `.env.production` existe et n'est pas vide (si configur√©)
4. Si Admin Central manquant ‚Üí tentative de cr√©ation automatique
5. Si toujours manquant ‚Üí **BLOQUER le build** avec message d'erreur clair

**PENDANT le build** :
- Utiliser `--env-file .env.production` pour charger les variables
- V√©rifier que le build r√©ussit
- Si √©chec ‚Üí v√©rifier les logs et les variables d'environnement

**APR√àS le build** :
- V√©rifier que les containers d√©marrent correctement
- V√©rifier les health checks
- V√©rifier les logs pour d√©tecter les erreurs

#### Scripts de protection

- `./scripts/protect-env-files.sh --backup` : Sauvegarder les fichiers
- `./scripts/protect-env-files.sh --check` : V√©rifier l'existence
- `./scripts/protect-env-files.sh --restore` : Restaurer depuis backup
- `./scripts/protect-env-files.sh --auto-create-admin` : Cr√©er Admin Central si manquant

#### R√®gles d'application

‚úÖ **√Ä FAIRE** :
- V√©rifier `.env.production` pour Reboul Store ET Admin Central
- Sauvegarder avant chaque d√©ploiement
- Bloquer le build si fichiers manquants
- Cr√©er automatiquement Admin Central si possible
- Appliquer les m√™mes protections partout (coh√©rence architecture)

‚ùå **√Ä √âVITER** :
- Builder sans v√©rifier `.env.production`
- Builder avec un fichier vide
- Appliquer des protections seulement √† un projet
- Ignorer les erreurs de build
- Continuer le d√©ploiement si `.env.production` manque

### V√©rification et r√©paration des erreurs de build

**R√àGLE OBLIGATOIRE** : Toutes les erreurs de build doivent √™tre v√©rifi√©es et r√©par√©es.

#### Processus obligatoire

1. **D√©tection d'erreur** :
   - ‚úÖ Analyser les logs de build pour identifier l'erreur
   - ‚úÖ V√©rifier les variables d'environnement manquantes
   - ‚úÖ V√©rifier les fichiers manquants (`.env.production`, etc.)

2. **R√©paration automatique** :
   - ‚úÖ Si `.env.production` manquant ‚Üí restaurer depuis backup
   - ‚úÖ Si Admin Central manquant ‚Üí cr√©er automatiquement
   - ‚úÖ Si variables manquantes ‚Üí informer l'utilisateur

3. **Blocage si n√©cessaire** :
   - ‚úÖ Bloquer le build si `.env.production` manquant
   - ‚úÖ Bloquer le build si erreur critique non r√©parable
   - ‚úÖ Afficher des messages d'erreur clairs avec solutions

4. **Documentation** :
   - ‚úÖ Documenter les erreurs rencontr√©es
   - ‚úÖ Documenter les solutions appliqu√©es
   - ‚úÖ Mettre √† jour les scripts pour √©viter les erreurs futures

#### Coh√©rence architecture

**R√àGLE CRITIQUE** : Toutes les protections et v√©rifications doivent √™tre appliqu√©es de mani√®re coh√©rente √† tous les projets.

- ‚úÖ Si une protection est ajout√©e pour Admin Central ‚Üí l'ajouter pour Reboul Store
- ‚úÖ Si une v√©rification est ajout√©e pour Reboul Store ‚Üí l'ajouter pour Admin Central
- ‚úÖ M√™me niveau de protection partout
- ‚úÖ M√™me processus de v√©rification partout
- ‚úÖ M√™me gestion d'erreurs partout

**Exemples** :
- V√©rification `.env.production` ‚Üí Reboul Store ET Admin Central
- Sauvegarde automatique ‚Üí Reboul Store ET Admin Central
- V√©rification fichiers vides ‚Üí Reboul Store ET Admin Central
- Messages d'erreur ‚Üí m√™me format pour les deux projets

### üíæ Sauvegarde Automatique Base de Donn√©es - OBLIGATOIRE

**R√àGLE CRITIQUE** : La base de donn√©es DOIT √™tre sauvegard√©e automatiquement avant toute modification risqu√©e.

#### Objectif : Ne jamais perdre de donn√©es

**Principe fondamental** : Toute modification de la base de donn√©es (migration, modification de sch√©ma, suppression, etc.) peut potentiellement causer une perte de donn√©es. Une sauvegarde automatique AVANT chaque op√©ration risqu√©e est OBLIGATOIRE.

#### Quand l'IA sauvegarde automatiquement

**L'IA DOIT sauvegarder automatiquement la base de donn√©es dans ces cas** :

1. **Avant chaque migration** :
   - ‚úÖ **OBLIGATOIRE** : Sauvegarder avant d'ex√©cuter une migration
   - ‚úÖ Utiliser : `./rcli db backup --server`
   - ‚úÖ V√©rifier que le backup a r√©ussi avant de continuer
   - ‚úÖ Si le backup √©choue ‚Üí **NE PAS ex√©cuter la migration**

2. **Avant toute modification de sch√©ma** :
   - ‚úÖ Avant `ALTER TABLE` (ajout/suppression de colonnes)
   - ‚úÖ Avant `DROP TABLE` ou `DROP COLUMN`
   - ‚úÖ Avant `TRUNCATE TABLE`
   - ‚úÖ Avant modification de contraintes (foreign keys, unique, etc.)

3. **Avant op√©rations de nettoyage massif** :
   - ‚úÖ Avant `DELETE FROM table WHERE ...` (suppressions en masse)
   - ‚úÖ Avant scripts de nettoyage de donn√©es
   - ‚úÖ Avant migrations de donn√©es (transformation de donn√©es)

4. **Avant restauration d'une ancienne base** :
   - ‚úÖ Si l'utilisateur mentionne restaurer une ancienne base
   - ‚úÖ Sauvegarder l'√©tat actuel AVANT de restaurer
   - ‚úÖ Permettre de revenir en arri√®re si n√©cessaire

5. **Avant corrections de bugs critiques** :
   - ‚úÖ Si correction d'un bug qui modifie la structure de la DB
   - ‚úÖ Si correction qui peut affecter les donn√©es existantes

6. **Sur demande explicite de l'utilisateur** :
   - ‚úÖ Si l'utilisateur demande explicitement une sauvegarde
   - ‚úÖ Avant toute op√©ration qu'il juge risqu√©e

#### Processus de sauvegarde automatique

**√âtape 1 : D√©tection de l'op√©ration risqu√©e**
- L'IA d√©tecte qu'une op√©ration va modifier la base de donn√©es
- Exemples : migration, `ALTER TABLE`, `DROP`, `DELETE` massif, etc.

**√âtape 2 : Sauvegarde automatique (OBLIGATOIRE)**
```bash
# Sauvegarde automatique avant op√©ration risqu√©e
./rcli db backup --server
```

**√âtape 3 : V√©rification du succ√®s**
- ‚úÖ V√©rifier que le backup a r√©ussi (code de retour, fichier cr√©√©)
- ‚úÖ Si √©chec ‚Üí **BLOQUER l'op√©ration** et informer l'utilisateur
- ‚úÖ Afficher le nom du fichier de backup cr√©√©

**√âtape 4 : Ex√©cution de l'op√©ration**
- ‚úÖ Seulement si le backup a r√©ussi
- ‚úÖ Ex√©cuter l'op√©ration demand√©e
- ‚úÖ V√©rifier le r√©sultat

**√âtape 5 : Confirmation**
- ‚úÖ Informer l'utilisateur que le backup a √©t√© cr√©√©
- ‚úÖ Donner le nom du fichier de backup
- ‚úÖ Rappeler comment restaurer si n√©cessaire

#### Exemples concrets

**Exemple 1 : Migration Collections**
```bash
# 1. D√©tection : Migration va cr√©er/modifier des tables
# 2. Sauvegarde automatique
./rcli db backup --server
# ‚úÖ Backup cr√©√© : reboulstore_db_20251231_085357.sql.gz

# 3. V√©rification succ√®s
# ‚úÖ Backup r√©ussi

# 4. Ex√©cution migration
# ... ex√©cution migration ...

# 5. Confirmation
# ‚úÖ Migration ex√©cut√©e. Backup disponible : reboulstore_db_20251231_085357.sql.gz
```

**Exemple 2 : Modification de sch√©ma**
```bash
# 1. D√©tection : ALTER TABLE va modifier la structure
# 2. Sauvegarde automatique
./rcli db backup --server
# ‚úÖ Backup cr√©√© avant modification

# 3. Ex√©cution ALTER TABLE
# ... modification ...
```

**Exemple 3 : Suppression de donn√©es**
```bash
# 1. D√©tection : DELETE FROM va supprimer des donn√©es
# 2. Sauvegarde automatique
./rcli db backup --server
# ‚úÖ Backup cr√©√© avant suppression

# 3. Ex√©cution DELETE
# ... suppression ...
```

#### Sauvegardes automatiques programm√©es

**En plus des sauvegardes avant op√©rations risqu√©es** :

1. **Backup automatique quotidien** (cron job) :
   - ‚úÖ Configur√© via : `./rcli server cron --enable-backup`
   - ‚úÖ Ex√©cution : Tous les jours √† 2h du matin
   - ‚úÖ Conservation : 30 derniers backups automatiquement

2. **Backup avant d√©ploiement** :
   - ‚úÖ Workflow recommand√© : `./rcli server backup --full`
   - ‚úÖ Sauvegarde DB + fichiers + configs
   - ‚úÖ Avant chaque d√©ploiement en production

#### R√®gles d'application

‚úÖ **√Ä FAIRE** :
- Sauvegarder automatiquement AVANT chaque migration
- Sauvegarder automatiquement AVANT chaque modification de sch√©ma
- Sauvegarder automatiquement AVANT chaque suppression de donn√©es
- V√©rifier que le backup a r√©ussi avant de continuer
- Informer l'utilisateur du nom du fichier de backup
- Bloquer l'op√©ration si le backup √©choue
- Utiliser `./rcli db backup --server` pour les sauvegardes

‚ùå **√Ä √âVITER** :
- Ex√©cuter une migration sans sauvegarde pr√©alable
- Modifier le sch√©ma sans sauvegarde
- Supprimer des donn√©es sans sauvegarde
- Ignorer un √©chec de backup
- Continuer une op√©ration si le backup a √©chou√©

#### Gestion des backups

**Emplacement** : `/opt/reboulstore/backups/` (serveur)

**Nommage** : `reboulstore_db_YYYYMMDD_HHMMSS.sql.gz`

**Conservation** :
- ‚úÖ 30 derniers backups automatiques (cron quotidien)
- ‚úÖ Backups manuels : conserv√©s jusqu'√† suppression manuelle
- ‚úÖ Backups avant migrations : conserv√©s (important pour rollback)

**Restoration** :
```bash
# Lister les backups disponibles
./rcli db backup-list

# Restaurer un backup
./rcli db backup-restore reboulstore_db_20251231_085357.sql.gz --yes
```

#### Communication avec l'utilisateur

**Quand l'IA sauvegarde automatiquement** :
- ‚úÖ Informer : "üíæ Sauvegarde automatique de la base de donn√©es avant [op√©ration]..."
- ‚úÖ Confirmer : "‚úÖ Backup cr√©√© : `reboulstore_db_YYYYMMDD_HHMMSS.sql.gz`"
- ‚úÖ Si √©chec : "‚ùå √âchec du backup. Op√©ration annul√©e pour s√©curit√©."

**Message type** :
```
üíæ Sauvegarde automatique de la base de donn√©es avant migration...
‚úÖ Backup cr√©√© : reboulstore_db_20251231_085357.sql.gz
üöÄ Ex√©cution de la migration...
```

#### Coh√©rence architecture

**R√àGLE CRITIQUE** : Les sauvegardes automatiques s'appliquent √† TOUTES les bases de donn√©es du projet.

- ‚úÖ Reboul Store : Sauvegarde avant modifications
- ‚úÖ Admin Central : Sauvegarde avant modifications (si base s√©par√©e)
- ‚úÖ Toutes les bases : M√™me niveau de protection

#### Exceptions (sauvegarde non n√©cessaire)

**Cas o√π la sauvegarde automatique n'est PAS n√©cessaire** :
- ‚ùå Requ√™tes SELECT (lecture seule)
- ‚ùå Requ√™tes INSERT simples (ajout de nouvelles donn√©es)
- ‚ùå Requ√™tes UPDATE simples (modification de valeurs sans changement de structure)
- ‚ùå Op√©rations de lecture (GET, LIST, etc.)

**R√®gle d'or** : Si l'op√©ration peut causer une perte de donn√©es ou modifier la structure ‚Üí **SAUVEGARDE OBLIGATOIRE**

---

## üìì Vault Obsidian - Utilisation et Maintenance

### Vue d'ensemble

Le vault Obsidian (`obsidian-vault/`) contient tous les workflows et r√®gles du projet sous forme visuelle (Canvas) et document√©e. Il sert de r√©f√©rence pour comprendre les processus et suivre l'avancement.

### Quand consulter Obsidian

**L'IA DOIT consulter Obsidian dans ces cas** :

1. **Au d√©but d'une session de travail** :
   - ‚úÖ Consulter `obsidian-vault/Home.md` pour voir l'√©tat actuel
   - ‚úÖ Consulter les Canvas pertinents selon la t√¢che (ex: `Workflow-Dev.canvas` pour d√©veloppement)
   - ‚úÖ V√©rifier les workflows avant de commencer

2. **Avant d'ex√©cuter un workflow** :
   - ‚úÖ Consulter le Canvas correspondant (ex: `Workflow-Figma.canvas` avant design)
   - ‚úÖ V√©rifier les r√®gles critiques (ex: `Regle-Database.canvas` avant DB)
   - ‚úÖ Suivre les √©tapes d√©finies dans le Canvas

3. **Quand l'utilisateur modifie un Canvas** :
   - ‚úÖ Lire les modifications dans le Canvas
   - ‚úÖ Comprendre les changements de workflow
   - ‚úÖ Adapter mon comportement selon les modifications

4. **Quand l'utilisateur demande un workflow** :
   - ‚úÖ Consulter le Canvas correspondant
   - ‚úÖ Suivre les √©tapes d√©finies
   - ‚úÖ R√©f√©rencer le Canvas dans ma r√©ponse

5. **Pour comprendre les r√®gles critiques** :
   - ‚úÖ Consulter `Regle-Database.canvas` avant toute op√©ration DB
   - ‚úÖ Consulter `Regle-Deploiement.canvas` avant d√©ploiement
   - ‚úÖ V√©rifier les interdictions et bonnes pratiques

### Quand mettre √† jour Obsidian

**L'IA DOIT mettre √† jour Obsidian dans ces cas** :

1. **Apr√®s modification d'un fichier MD principal** :
   - ‚úÖ Si `ROADMAP_COMPLETE.md` est modifi√© ‚Üí V√©rifier si les Canvas doivent √™tre mis √† jour
   - ‚úÖ Si `CONTEXT.md` est modifi√© ‚Üí V√©rifier si les workflows ont chang√©
   - ‚úÖ Si `BACKEND.md` ou `FRONTEND.md` est modifi√© ‚Üí V√©rifier si les Canvas workflows sont √† jour

2. **Apr√®s cr√©ation d'un nouveau workflow** :
   - ‚úÖ Cr√©er un nouveau Canvas pour le workflow
   - ‚úÖ Ajouter le lien dans `Home.md` et `Index.md`
   - ‚úÖ Documenter dans `Canvas/README.md`

3. **Apr√®s modification d'une r√®gle critique** :
   - ‚úÖ Mettre √† jour le Canvas correspondant (ex: `Regle-Database.canvas`)
   - ‚úÖ V√©rifier que les interdictions et bonnes pratiques sont √† jour

4. **Apr√®s compl√©tion d'une phase** :
   - ‚úÖ V√©rifier si les Canvas doivent refl√©ter les changements
   - ‚úÖ Mettre √† jour les workflows si n√©cessaire

**L'IA NE DOIT PAS mettre √† jour Obsidian** :
- ‚ùå Si l'utilisateur modifie un Canvas (c'est lui qui g√®re)
- ‚ùå Sans demander confirmation si modification importante
- ‚ùå Si les modifications sont mineures et n'affectent pas les workflows

### Comment suivre les workflows depuis Obsidian

**Processus de suivi** :

1. **Identifier le workflow** :
   - L'utilisateur demande une t√¢che ‚Üí Identifier le workflow concern√©
   - Consulter le Canvas correspondant dans `obsidian-vault/Canvas/`

2. **Lire le Canvas** :
   - Ouvrir le fichier `.canvas` (format JSON)
   - Comprendre les √©tapes d√©finies
   - Identifier les r√®gles et interdictions

3. **Suivre les √©tapes** :
   - Ex√©cuter les √©tapes dans l'ordre d√©fini
   - Respecter les r√®gles critiques
   - V√©rifier les interdictions avant d'agir

4. **Adapter selon modifications** :
   - Si l'utilisateur a modifi√© le Canvas ‚Üí Lire les modifications
   - Adapter mon comportement selon les changements
   - Suivre la nouvelle version du workflow

**Exemples concrets** :

- **D√©veloppement Backend** :
  1. Consulter `Workflow-Dev.canvas` ‚Üí Voir les √©tapes
  2. Consulter `Workflow-Pedagogique.canvas` ‚Üí Mode p√©dagogique
  3. Suivre les √©tapes : donner code, expliquer, v√©rifier, corriger

- **D√©ploiement** :
  1. Consulter `Regle-Deploiement.canvas` ‚Üí Voir les interdictions
  2. Consulter `Workflow-Deploy.canvas` ‚Üí Voir les √©tapes
  3. Suivre : backup, arr√™t (sans -v), build, v√©rification

- **Design Figma** :
  1. Consulter `Workflow-Figma.canvas` ‚Üí Voir les phases
  2. Consulter `Workflow-Pedagogique.canvas` ‚Üí Mode guide
  3. Suivre : guider, valider design, coder

### Modification des Canvas par l'utilisateur

**Quand l'utilisateur modifie un Canvas** :

1. **D√©tecter les modifications** :
   - ‚úÖ Lire le fichier Canvas modifi√©
   - ‚úÖ Comparer avec ma compr√©hension pr√©c√©dente
   - ‚úÖ Identifier les changements (nouveaux n≈ìuds, nouvelles connexions, texte modifi√©)

2. **Comprendre les changements** :
   - ‚úÖ Analyser les modifications pour comprendre l'intention
   - ‚úÖ Adapter ma compr√©hension du workflow
   - ‚úÖ Suivre la nouvelle version du workflow

3. **Appliquer les changements** :
   - ‚úÖ Utiliser la nouvelle version du workflow dans mes r√©ponses
   - ‚úÖ R√©f√©rencer les modifications si pertinent
   - ‚úÖ Ne pas revenir √† l'ancienne version

**Exemple** :
- L'utilisateur modifie `Workflow-Pedagogique.canvas` pour ajouter une √©tape
- Je dois lire le Canvas modifi√©
- Comprendre la nouvelle √©tape
- Suivre le nouveau workflow dans mes r√©ponses futures

### Structure Obsidian

**Fichiers principaux** :
- `obsidian-vault/Home.md` - Point d'entr√©e
- `obsidian-vault/Index.md` - Index complet
- `obsidian-vault/Canvas/` - Tous les Canvas visuels
- `obsidian-vault/Workflows/` - Documentation workflows
- `obsidian-vault/Integrations/` - Documentation int√©grations

**Canvas par cat√©gorie** :
- **Architecture** : `Architecture.canvas`, `Integrations.canvas`
- **Workflows** : `Workflow-Dev.canvas`, `Workflow-Deploy.canvas`, `Workflow-Figma.canvas`, etc.
- **R√®gles** : `Regle-Database.canvas`, `Regle-Deploiement.canvas`

### R√®gles d'application

‚úÖ **√Ä FAIRE** :
- Consulter Obsidian au d√©but de chaque session
- Suivre les workflows d√©finis dans les Canvas
- Respecter les r√®gles critiques document√©es
- Lire les modifications de Canvas par l'utilisateur
- Adapter mon comportement selon les Canvas

‚ùå **√Ä √âVITER** :
- Ignorer les Canvas lors de l'ex√©cution d'un workflow
- Modifier les Canvas sans confirmation (sauf cas explicites)
- Ne pas suivre les r√®gles critiques document√©es
- Utiliser une ancienne version d'un workflow si le Canvas a √©t√© modifi√©

### Cr√©ation de nouveaux workflows

**Processus de cr√©ation d'un nouveau workflow** :

1. **Phase 1 : Design dans Obsidian (PRIORITAIRE)**
   - ‚úÖ Cr√©er un nouveau Canvas dans `obsidian-vault/Canvas/` pour visualiser le workflow
   - ‚úÖ Discuter et it√©rer sur le Canvas ensemble
   - ‚úÖ Valider le workflow visuellement avant de l'ajouter aux r√®gles
   - ‚úÖ Avantage : Visualisation claire, it√©ration facile, validation avant impl√©mentation

2. **Phase 2 : Documentation**
   - ‚úÖ Cr√©er un document Markdown dans `obsidian-vault/Workflows/` expliquant le workflow
   - ‚úÖ Ajouter les liens dans `Home.md` et `Index.md`
   - ‚úÖ Documenter dans `Canvas/README.md`

3. **Phase 3 : Ajout aux project-rules**
   - ‚úÖ Une fois le workflow valid√© dans Obsidian, l'ajouter aux `project-rules.mdc`
   - ‚úÖ Cr√©er la section correspondante dans les r√®gles
   - ‚úÖ R√©f√©rencer le Canvas Obsidian dans les r√®gles

**Ordre recommand√©** :
1. **Obsidian d'abord** (Canvas + document) ‚Üí Design et validation
2. **Project-rules ensuite** ‚Üí Ajout aux r√®gles une fois valid√©
3. **Utilisation** ‚Üí Appliquer le workflow dans le projet

**Avantages de cette approche** :
- ‚úÖ Visualisation claire du workflow avant impl√©mentation
- ‚úÖ It√©ration facile sur le design (modification Canvas)
- ‚úÖ Validation ensemble avant d'ajouter aux r√®gles
- ‚úÖ Trace visuelle permanente dans Obsidian
- ‚úÖ S√©paration claire entre design (Obsidian) et r√®gles (project-rules)

**Exception** :
- Si le workflow est tr√®s simple ou √©vident, on peut l'ajouter directement aux project-rules
- Mais pour les workflows complexes, toujours commencer par Obsidian

### Communication avec l'utilisateur

**Quand je consulte Obsidian** :
- ‚úÖ Informer : "üìì Consultation du workflow dans Obsidian..."
- ‚úÖ R√©f√©rencer : "Selon `Workflow-Dev.canvas`, les √©tapes sont..."

**Quand je d√©tecte une modification de Canvas** :
- ‚úÖ Informer : "üìù J'ai d√©tect√© des modifications dans `Workflow-X.canvas`"
- ‚úÖ Confirmer : "Je vais suivre la nouvelle version du workflow"

**Quand je dois mettre √† jour Obsidian** :
- ‚úÖ Demander confirmation : "Souhaitez-vous que je mette √† jour le Canvas `X.canvas` pour refl√©ter ces changements ?"
- ‚úÖ Informer : "‚úÖ Canvas `X.canvas` mis √† jour"

**Quand vous proposez un nouveau workflow** :
- ‚úÖ Sugg√©rer : "Cr√©ons d'abord un Canvas dans Obsidian pour visualiser ce workflow ?"
- ‚úÖ Cr√©er le Canvas ensemble
- ‚úÖ It√©rer sur le design
- ‚úÖ Une fois valid√©, proposer : "Souhaitez-vous que j'ajoute ce workflow aux project-rules ?"
